#load "core/module"

use core {*}

// Returns the number of fields
process_passport :: (contents: &str) -> u32 {
    field_count := 0

    while true {
        line := str.read_until(contents, '\n')
        str.advance(contents, 1)
        if line.count == 0 do break

        fields := str.split(line, ' ')
        defer cfree(fields.data)

        for field in fields {
            data := str.split(field, ':')
            defer cfree(data.data)

            if !str.equal(data[0], "cid") {
                field_count += 1
            }
        }
    }

    return field_count
}

// This does not include part 2 because it is gross and
// not worth the effort to implement it.
main :: (args: [] cstr) {
    contents := #file_contents "./input/day4.txt"

    valid_passports := 0
    while true {
        if contents.count == 0 do break

        field_count := process_passport(&contents)
        if field_count == 7 do valid_passports += 1
    }

    printf("Valid passports: {}\n", valid_passports)
}
